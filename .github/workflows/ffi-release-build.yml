name: Release EasyTier FFI

on:
  push:
    tags:
      - "*"

jobs:
  release:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          toolchain: stable

      - name: Build x86 DLL
        run: cargo build --release -p easytier-ffi --target i686-pc-windows-msvc

      - name: Build x64 DLL
        run: cargo build --release -p easytier-ffi --target x86_64-pc-windows-msvc

      - name: Package DLLs
        run: |
          mkdir release
          copy target\i686-pc-windows-msvc\release\easytier_ffi.dll release\easytier_ffi_x86.dll
          copy target\x86_64-pc-windows-msvc\release\easytier_ffi.dll release\easytier_ffi_x64.dll
          dir release

      - name: Upload DLLs as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: easytier-ffi-dll
          path: release/*.dll

      - name: Create GitHub Release and Upload DLLs
        uses: softprops/action-gh-release@v2
        with:
          name: EasyTier FFI ${{ github.ref_name }}
          tag_name: ${{ github.ref_name }}
          files: release/*.dll
          body: |
            <div align="center">

            # ðŸš€ EasyTier FFI ${{ github.ref_name }}

            ![Platform](https://img.shields.io/badge/platform-Windows-blue)
            ![Rust](https://img.shields.io/badge/rust-stable-orange)
            ![Build](https://img.shields.io/badge/build-release-success)
            ![License](https://img.shields.io/badge/license-MIT-green)

            </div>

            ---

            ## ðŸ“¦ Build Information

            | Item | Value |
            |------|--------|
            | Version | `${{ github.ref_name }}` |
            | Commit | `${{ github.sha }}` |
            | Targets | x86, x64 |
            | Profile | release |
            | CI | GitHub Actions |

            ---

            ## ðŸ“¥ Download

            ðŸ‘‰ Download attached **`easytier_ffi_x86.dll`** and **`easytier_ffi_x64.dll`**

            ---

            ## ðŸ”’ Build Guarantee

            - Built in official GitHub Windows environment
            - Fully optimized release build
            - Generated automatically from tag `${{ github.ref_name }}`
